(function($){$.fn.simpleColorPicker=function(options){var self=this;this.defaults={colors:['#FFF','#CCC','#C0C0C0','#999','#666','#333','#000','#FCC','#F66','#F00','#C00','#900','#600','#300','#FC9','#F96','#F90','#F60','#C60','#930','#630','#FF9','#FF6','#FC6','#FC3','#C93','#963','#633','#FFC','#FF3','#FF0','#FC0','#990','#660','#330','#9F9','#6F9','#3F3','#3C0','#090','#060','#030','#9FF','#3FF','#6CC','#0CC','#399','#366','#033','#CFF','#6FF','#3CF','#36F','#33F','#009','#006','#CCF','#99F','#66C','#63F','#60C','#339','#309','#FCF','#F9F','#C6C','#C3C','#939','#636','#303'],columns:7,hexInput:true,onChoose:null,onShow:null,onHide:null,pickerId:'simple-picker'};this.isTouch=(/ipad|ipod|iphone|android/i).test(navigator.userAgent);this.CLICK=self.isTouch?'touchend':'click';this.KEYUP='keyup';this.options=$.extend({},this.defaults,options);this.picker;this.hexRow;this.element=null;this.elementInfo={};this.prevElement=null;this.createPicker=function(){self.picker=$('<div></div>');self.picker.addClass('scp-color-picker');self.picker.attr('id',self.options.pickerId);var samples=$('<div></div>');samples.addClass('scp-samples');samples.appendTo(self.picker);var i=0;while(i<self.options.colors.length){var sampleRow=$('<div></div>');sampleRow.addClass('scp-sample-row');for(var j=0;j<self.options.columns;j++){if(!self.options.colors[i])break;var sample=$('<div></div>');sample.addClass('scp-sample-color');sample.attr('title',self.options.colors[i]);sample.css('background-color',self.options.colors[i]);sample.bind(self.CLICK,self.colorSelect);sampleRow.append(sample);i++;}
samples.append(sampleRow);}
if(self.options.hexInput){self.hexRow=$('<div></div>');self.hexRow.addClass('scp-hexrow');self.hexRow.bind(self.CLICK,function(event){event.preventDefault();event.stopPropagation();});var hexRowLabel=$('<div></div>');hexRowLabel.addClass('scp-hexrow-label');hexRowLabel.text('#');hexRowLabel.appendTo(self.hexRow);var hexRowInput=$('<input />');hexRowInput.attr('type','text');hexRowInput.attr('maxlength',6);hexRowInput.val('000000');hexRowInput.addClass('scp-hexrow-input');hexRowInput.appendTo(self.hexRow);hexRowInput.bind(self.KEYUP,self.inputHex);hexRowInput.bind(self.CLICK,self.inputHex);var hexRowSample=$('<div></div>');hexRowSample.attr('title','#000');hexRowSample.addClass('scp-hexrow-sample');hexRowSample.bind(self.CLICK,self.colorSelect);hexRowSample.appendTo(self.hexRow);self.picker.append(self.hexRow);}
self.picker.appendTo(document.body);}
this.showPicker=function(event,targ){event.stopPropagation();if(self.element!=targ){self.element=targ;self.positionPicker();self.picker.show();}
else
self.hidePicker(event);if(typeof self.options.onShow=='function')self.options.onShow(event,$(self.element),self.picker);}
this.positionPicker=function(){self.calcElementInfo();self.picker.css({left:self.elementInfo.offset.left,top:self.elementInfo.offset.bottom});}
this.hidePicker=function(event){if(!self.picker.is(':visible'))return;event.stopPropagation();self.prevElement=self.element;self.element=null;self.picker.hide();if(typeof self.options.onHide=='function')self.options.onHide(event,$(self.prevElement),self.picker);}
this.colorSelect=function(event){event.stopPropagation();var color=$(this).attr('title');self.hidePicker(event);if(typeof self.options.onChoose=='function')
self.options.onChoose(color,event,$(self.element),self.picker);else
return color;}
this.inputHex=function(event){var et;et=event.type;if(et=='click'){event.preventDefault();event.stopPropagation();}
if(et.match(/key/)){var kc,hrs,val;kc=event.keyCode;hrs=self.hexRow.find('.scp-hexrow-sample');switch(kc){case 13:event.preventDefault();hrs.click();break;default:val=self.hexRow.find('input').val();hrs.css('background','#'+val);hrs.attr('title','#'+val);break;}}};this.correctOptions=function(){self.options.columns=parseInt(self.options.columns);if(self.options.colors.length<self.options.columns)
self.options.columns=self.options.colors.length;}
this.calcElementInfo=function(){self.elementInfo={offset:{top:$(self.element).offset().top,right:$(self.element).offset().left+$(self.element).outerWidth(),bottom:$(self.element).offset().top+$(self.element).outerHeight(),left:$(self.element).offset().left}}}
self.correctOptions();self.createPicker();$(document).bind(self.CLICK,self.hidePicker);return this.each(function(){$(this).click(function(event){self.showPicker(event,this);});});};})(jQuery);